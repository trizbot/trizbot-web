<mat-toolbar class="topbar gap-10" style="font-size: 16px; display: flex; justify-content: space-between;">

  <!-- Left: Mobile Menu -->
  <div class="d-flex align-items-center">
    <button mat-icon-button (click)="toggleMobileNav.emit()" class="d-flex d-lg-none justify-content-center">
      <i-tabler name="menu-2" class="icon-24 d-flex"></i-tabler>
    </button>
  </div>

  <!-- Right: Notification, Welcome, Profile -->
  <div class="d-flex align-items-center gap-2 ms-auto">

    <!-- Notification Bell -->
    <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Notifications">
      <i-tabler name="bell" class="icon-28" matBadge="{{countNotification}}" matBadgeColor="accent"></i-tabler>
    </button>
















    
    
    <mat-menu #menu="matMenu">
      <ng-container  *ngIf="!isShowingNotification">
        <button
          mat-menu-item
          *ngFor="let notification of notifications"
          (click)="onShowFullText(notification.text,notification.title,notification._id)"
          
          style="font-weight: bold; font-size: 16px; white-space: normal; text-align: left; line-height: 1.4;">
          <div>
            <div style="font-size: 16px; font-weight: 600;">{{ notification.title }}</div>
            <div style="font-size: 14px; color: #555; padding-top:9px"> 
              {{ notification.text.length > 50 ? (notification.text | slice:0:50) + '...' : notification.text }}
            </div>

          </div>
        </button>
      </ng-container>

    <!-- Show a detail -->
<ng-container *ngIf="isShowingNotification">
  <button mat-menu-item style="padding: 12px 16px;">
    <div class="flex items-start justify-between gap-3 w-full">
      
      <!-- Left section with back icon -->
      <div class="flex items-start gap-3">
        <mat-icon color="primary" style="font-size: 24px;" (click)="onMarkAsRead(showNotificationId)">arrow_back</mat-icon>
        <div>
          <div style="font-size: 18px; font-weight: 700; color:text-primary;"  (click)="onMarkAsRead(showNotificationId)">
            {{ showNotificationTitle }}
          </div>
          
          <div style="font-size: 14px; color: #4b5563; padding-top: 16px;"  (click)="onMarkAsRead(showNotificationId)">
            {{ showNotificationText }}
          </div>
        </div>
      </div>

    </div>
  </button>
</ng-container>

      

      <ng-template #noNotifications>
        <button mat-menu-item disabled style="font-style: italic; color: #999;">
          No notifications available.
        </button>
      </ng-template>
      
  
    </mat-menu>
    

    <!-- Welcome Message -->
    <div class="d-md-flex align-items-center fw-semibold pe-3" style="font-size: 17px;">
      {{ firstName }} {{ lastName }}!
    </div>

    <!-- Create Admin Button -->
    <a *ngIf="isSuperEntityType"
       mat-flat-button
       color="primary"
       class="bg-success text-white me-2"
       [routerLink]="['/myaccount/admin']"
       style="font-size: 15px;">
      Create Admin
    </a>

    <!-- Profile Avatar -->
    <button mat-mini-fab [matMenuTriggerFor]="profilemenu" aria-label="Profile Menu">
      <img [src]="imageSecureUrl || '/assets/images/profile/user-1.jpg'" 
           alt="Profile Picture"
           width="48"
           class="rounded-circle object-cover d-block" />
    </button>

    <!-- Profile Menu -->
    <mat-menu #profilemenu="matMenu" class="cardWithShadow topbar-dd" style="font-size: 15px;">
      <div class="px-4 py-3 text-center">
        <img [src]="imageSecureUrl || '/assets/images/profile/user-1.jpg'"
             alt="Profile"
             width="60"
             class="rounded-circle object-cover mb-2" />
        <div class="fw-semibold" style="font-size: 16px;">{{ firstName }} {{ lastName }}</div>
        <div style="font-size: 13px;">Status: <b class="text-primary">{{ authStatus }}</b></div>
      </div>

      <mat-divider></mat-divider>

      <ng-container *ngIf="isSuperEntityType">
        <button mat-menu-item [routerLink]="['/myaccount/users']" style="font-size: 15px;">
          <i-tabler name="list-check" class="icon-20 me-2"></i-tabler> Users
        </button>
      </ng-container>

      <button mat-menu-item [routerLink]="['/myaccount/profile']" style="font-size: 15px;">
        <i-tabler name="mail" class="icon-20 me-2"></i-tabler> Settings
      </button>

      <button mat-menu-item (click)="onLogout()">
        <i-tabler name="logout" class="w-100 icon-20 me-2"></i-tabler>
        Logout
      </button>

    </mat-menu>

  </div>

</mat-toolbar>
